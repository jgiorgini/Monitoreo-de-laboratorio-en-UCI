<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Laboratorios UCI (V10c)</title>

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

    <!-- pdf.js (debe cargarse antes de app_v10c.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.13.216/pdf.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .lab-input { min-height: 200px; resize: vertical; font-family: monospace; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); z-index: 10; display: flex; justify-content: center; align-items: center; }
        .uci-table-fixed th { position: sticky; top: 0; background-color: #bfdbfe; z-index: 5; }
    </style>
</head>
<body class="p-4">

<div id="app" class="max-w-7xl mx-auto bg-white p-6 rounded-xl shadow-2xl">
    <header class="mb-6 border-b pb-4">
        <h1 class="text-3xl font-bold text-blue-800">
            Monitor de Laboratorios UCI
            <span class="text-sm bg-indigo-300 px-2 py-0.5 rounded">V10c</span>
        </h1>
        <p class="text-sm text-gray-500">
            Carga de PDF/texto, parsing robusto y seguimiento diario por paciente crítico.
        </p>
    </header>

    <!-- 1. CARGA DE DATOS -->
    <section class="mb-8 p-4 border rounded-lg bg-gray-50">
        <h2 class="text-xl font-semibold mb-3 text-gray-700">1. Carga de laboratorio (texto o PDF)</h2>
        <textarea id="labInput" class="lab-input w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Pegue aquí el texto del laboratorio o cargue un PDF..."></textarea>
        <div class="flex flex-wrap gap-3 mt-3">
            <div>
                <input type="file" id="pdfInput" accept="application/pdf" class="hidden">
                <label for="pdfInput" class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg cursor-pointer hover:bg-blue-700 transition duration-150">
                    Cargar PDF (OCR/Digital)
                </label>
            </div>
            <button id="btnProcesarTexto" class="px-6 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition duration-150">
                Procesar texto y guardar
            </button>
            <button id="btnLimpiarEntrada" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition duration-150">
                Limpiar entrada
            </button>
        </div>
    </section>

    <!-- 2. SELECCIÓN Y SALIDA -->
    <section class="mb-8 p-4 border rounded-lg">
        <h2 class="text-xl font-semibold mb-3 text-gray-700">2. Exploración y salida</h2>
        <div class="data-grid mb-4">
            <div>
                <label for="patientSelector" class="block text-sm font-medium text-gray-700 mb-1">Seleccionar paciente:</label>
                <select id="patientSelector" class="w-full p-2 border border-gray-300 rounded-lg"></select>
            </div>
            <div>
                <label for="paramSelector" class="block text-sm font-medium text-gray-700 mb-1">Parámetro a graficar:</label>
                <select id="paramSelector" class="w-full p-2 border border-gray-300 rounded-lg"></select>
            </div>
       <div class="flex flex-col justify-end space-y-2">
    <button id="btnHCLAB" class="px-4 py-2 bg-yellow-500 text-white font-medium rounded-lg hover:bg-yellow-600 transition duration-150">
        Generar HCLAB (salida abreviada)
    </button>
    <button id="btnCSV" class="px-4 py-2 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 transition duration-150">
        Descargar CSV
    </button>
    <button id="btnReset" class="px-4 py-2 bg-red-500 text-white text-sm font-medium rounded-lg hover:bg-red-600 transition duration-150">
        Reset monitoreo (borrar todos)
    </button>
</div>
        <div id="hclabOutput" class="p-3 bg-blue-50 border border-blue-200 rounded-lg hidden"></div>
    </section>

    <!-- 3. GRÁFICO -->
    <section class="mb-8 p-4 border rounded-lg">
        <h2 class="text-xl font-semibold mb-3 text-gray-700">3. Gráfico de evolución temporal</h2>
        <div class="bg-gray-100 p-4 rounded-lg">
            <canvas id="evolutionChart" width="800" height="300"></canvas>
        </div>
    </section>

    <!-- 4. TABLA UCI -->
    <section class="p-4 border rounded-lg">
        <h2 class="text-xl font-semibold mb-3 text-gray-700">4. Tabla UCI (todas las variables por muestra)</h2>
        <div id="uciTableContainer" class="overflow-x-auto max-h-96 border border-gray-300 rounded-lg">
            <table id="uciTable" class="min-w-full divide-y divide-gray-200 uci-table-fixed">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
    </section>

</div>

<div id="loading" class="loading-overlay hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <p class="text-xl text-blue-600">Procesando laboratorio...</p>
    </div>
</div>

<!-- Lógica principal -->
<script src="app_v10c.js"></script>

</body>
</html>
